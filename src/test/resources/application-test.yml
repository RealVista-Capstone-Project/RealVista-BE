# Test Profile Configuration
# Uses H2 in-memory database for fast, isolated testing

spring:
  # Application Configuration
  application:
    frontend:
      url: http://localhost:3000

  # H2 In-Memory Database Configuration
  datasource:
    url: jdbc:h2:mem:testdb;MODE=PostgreSQL;DATABASE_TO_LOWER=TRUE;DEFAULT_NULL_ORDERING=HIGH
    driver-class-name: org.h2.Driver
    username: sa
    password:

  # JPA/Hibernate Configuration for H2
  jpa:
    database-platform: org.hibernate.dialect.H2Dialect
    hibernate:
      ddl-auto: create-drop
    show-sql: false
    properties:
      hibernate:
        format_sql: false

  # Flyway Configuration
  flyway:
    enabled: true
    # Use test-specific migrations that are H2-compatible
    locations: classpath:db/migration
    # Clean database between tests (optional)
    clean-disabled: false
    # Validate migrations
    validate-on-migrate: true

  # Security Configuration for Tests
  security:
    jwt:
      # Base64-encoded test secret key (minimum 256 bits for HS256)
      # This is: "test-secret-key-for-jwt-token-signing-in-unit-tests-only" in base64
      secret-key: dGVzdC1zZWNyZXQta2V5LWZvci1qd3QtdG9rZW4tc2lnbmluZy1pbi11bml0LXRlc3RzLW9ubHkK
      expiration: 86400000 # 24 hours

  # Disable Docker Compose for tests
  docker:
    compose:
      enabled: false

# Logging Configuration for Tests
logging:
  level:
    root: INFO
    com.sep.realvista: DEBUG
    org.springframework.web: INFO
    org.hibernate: WARN
    org.flywaydb: INFO

# Disable Actuator security for tests
management:
  security:
    enabled: false

# Google Maps API Configuration
# Only enabled if GOOGLE_MAPS_API_KEY environment variable is set
google:
  maps:
    # API Key from environment variable (will be null if not set)
    # Spring Expression Language: #{null} creates a proper null value
    api-key: ${GOOGLE_MAPS_API_KEY:#{null}}

    # HTTP client timeouts (milliseconds)
    connect-timeout-ms: 5000
    read-timeout-ms: 5000
    max-retries: 3

    # Rate limiting configuration
    rate-limit:
      queries-per-second: 10
      monthly-quota-limit: 5000
      enable-monitoring: true

    # Cache configuration for geocoding results
    cache:
      enabled: true
      ttl-seconds: 3600  # 1 hour for tests
      max-size: 1000