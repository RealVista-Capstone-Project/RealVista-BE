# Test Profile Configuration
# Uses H2 in-memory database for fast, isolated testing

spring:
  # Application Configuration
  application:
    frontend:
      url: http://localhost:3000

  # H2 In-Memory Database Configuration
  datasource:
    url: jdbc:h2:mem:testdb;MODE=PostgreSQL;DATABASE_TO_LOWER=TRUE;DEFAULT_NULL_ORDERING=HIGH
    driver-class-name: org.h2.Driver
    username: sa
    password:

  # JPA/Hibernate Configuration for H2
  jpa:
    database-platform: org.hibernate.dialect.H2Dialect
    hibernate:
      ddl-auto: create-drop
    show-sql: false
    properties:
      hibernate:
        format_sql: false

  # Flyway Configuration
  flyway:
    enabled: true
    # Use test-specific migrations that are H2-compatible
    locations: classpath:db/migration
    # Clean database between tests (optional)
    clean-disabled: false
    # Validate migrations
    validate-on-migrate: true

  # Security Configuration for Tests
  security:
    jwt:
      # Base64-encoded test secret key (minimum 256 bits for HS256)
      # This is: "test-secret-key-for-jwt-token-signing-in-unit-tests-only" in base64
      secret-key: dGVzdC1zZWNyZXQta2V5LWZvci1qd3QtdG9rZW4tc2lnbmluZy1pbi11bml0LXRlc3RzLW9ubHkK
      expiration: 86400000 # 24 hours
    oauth2:
      client:
        registration:
          google:
            client-id: test-google-client-id
            client-secret: test-google-client-secret
            redirect-uri: "{baseUrl}/login/oauth2/code/google"
            scope: profile,email
        provider:
          google:
            issuer-uri: https://accounts.google.com
      mobile:
        google:
          client-id: test-google-mobile-client-id

  # Disable Docker Compose for tests
  docker:
    compose:
      enabled: false

  # Logging Configuration for Tests
  logging:
    level:
      root: INFO
      com.sep.realvista: DEBUG
      org.springframework.web: INFO
      org.hibernate: WARN
      org.flywaydb: INFO

# Disable Actuator security for tests
management:
  security:
    enabled: false

